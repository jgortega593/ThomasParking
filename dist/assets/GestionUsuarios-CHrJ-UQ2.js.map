{"version":3,"file":"GestionUsuarios-CHrJ-UQ2.js","sources":["../../src/GestionUsuarios.jsx"],"sourcesContent":["import { useState, useEffect } from 'react'\r\nimport { supabase } from './supabaseClient'\r\nimport Loader from \"./components/Loader\"\r\nimport Emoji from './components/Emoji'\r\n\r\nexport default function GestionUsuarios({ usuarioActual }) {\r\n  const [usuarios, setUsuarios] = useState([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState(null)\r\n  const [modal, setModal] = useState({ open: false, usuario: null })\r\n  const [form, setForm] = useState({ email: '', nombre: '', rol: 'registrador', activo: true })\r\n  const [saving, setSaving] = useState(false)\r\n  const [deleting, setDeleting] = useState(false)\r\n\r\n  // Leer usuarios\r\n  const fetchUsuarios = async () => {\r\n    setLoading(true)\r\n    const { data, error } = await supabase\r\n      .from('usuarios_app')\r\n      .select('id, email, nombre, rol, activo')\r\n      .order('email', { ascending: true })\r\n    if (error) setError(error.message)\r\n    else setUsuarios(data)\r\n    setLoading(false)\r\n  }\r\n\r\n  useEffect(() => { fetchUsuarios() }, [])\r\n\r\n  // Abrir modal para editar\r\n  const handleEdit = (usuario) => {\r\n    setForm({\r\n      email: usuario.email,\r\n      nombre: usuario.nombre,\r\n      rol: usuario.rol,\r\n      activo: usuario.activo\r\n    })\r\n    setModal({ open: true, usuario })\r\n  }\r\n\r\n  // Abrir modal para crear\r\n  const handleNew = () => {\r\n    setForm({ email: '', nombre: '', rol: 'registrador', activo: true })\r\n    setModal({ open: true, usuario: null })\r\n  }\r\n\r\n  // Guardar usuario (crear o editar)\r\n  const handleSave = async (e) => {\r\n    e.preventDefault()\r\n    setSaving(true)\r\n    setError(null)\r\n    if (!form.email || !form.nombre || !form.rol) {\r\n      setError('Todos los campos son obligatorios')\r\n      setSaving(false)\r\n      return\r\n    }\r\n    try {\r\n      if (modal.usuario) {\r\n        // Editar\r\n        const { error } = await supabase\r\n          .from('usuarios_app')\r\n          .update({\r\n            email: form.email.trim().toLowerCase(),\r\n            nombre: form.nombre,\r\n            rol: form.rol,\r\n            activo: form.activo\r\n          })\r\n          .eq('id', modal.usuario.id)\r\n        if (error) throw error\r\n      } else {\r\n        // Crear\r\n        const { error } = await supabase\r\n          .from('usuarios_app')\r\n          .insert([{ ...form, email: form.email.trim().toLowerCase() }])\r\n        if (error) throw error\r\n      }\r\n      setModal({ open: false, usuario: null })\r\n      fetchUsuarios()\r\n    } catch (err) {\r\n      setError(err.message)\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  // Eliminar usuario\r\n  const handleDelete = async (usuario) => {\r\n    if (!window.confirm('¿Seguro que deseas eliminar este usuario?')) return\r\n    setDeleting(true)\r\n    setError(null)\r\n    try {\r\n      if (usuario.id === usuarioActual.id) {\r\n        setError('No puedes eliminar tu propio usuario.')\r\n        setDeleting(false)\r\n        return\r\n      }\r\n      const { error } = await supabase\r\n        .from('usuarios_app')\r\n        .delete()\r\n        .eq('id', usuario.id)\r\n      if (error) throw error\r\n      fetchUsuarios()\r\n    } catch (err) {\r\n      setError(err.message)\r\n    } finally {\r\n      setDeleting(false)\r\n    }\r\n  }\r\n\r\n  if (loading) return <Loader text=\"Cargando usuarios...\" />\r\n\r\n  return (\r\n    <div className=\"gestion-usuarios-container\">\r\n      <h2>\r\n        <Emoji symbol=\"👥\" label=\"Usuarios\" /> Gestión de Usuarios\r\n      </h2>\r\n      <button className=\"edit-btn\" onClick={handleNew} style={{ marginBottom: 18 }}>\r\n        <Emoji symbol=\"➕\" /> Nuevo usuario\r\n      </button>\r\n      <div style={{ fontSize: 13, color: '#888', marginBottom: 12 }}>\r\n        <Emoji symbol=\"⚠️\" /> Solo usuarios <b>administrador</b> pueden agregar, editar o eliminar usuarios.\r\n      </div>\r\n      <table className=\"resultados-table\" style={{ marginTop: 0 }}>\r\n        <thead>\r\n          <tr>\r\n            <th><Emoji symbol=\"✉️\" label=\"Email\" /> Email</th>\r\n            <th><Emoji symbol=\"🧑\" label=\"Nombre\" /> Nombre</th>\r\n            <th><Emoji symbol=\"🎖️\" label=\"Rol\" /> Rol</th>\r\n            <th><Emoji symbol=\"✔\" label=\"Activo\" /> Activo</th>\r\n            <th><Emoji symbol=\"⚙️\" label=\"Acciones\" /> Acciones</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {usuarios.map(u => (\r\n            <tr key={u.id}>\r\n              <td>{u.email}</td>\r\n              <td>{u.nombre}</td>\r\n              <td>\r\n                {u.rol === 'admin' ? <><Emoji symbol=\"👑\" /> Administrador</> : <><Emoji symbol=\"📋\" /> Registrador</>}\r\n              </td>\r\n              <td>{u.activo ? <Emoji symbol=\"✔\" /> : <Emoji symbol=\"❌\" />}</td>\r\n              <td>\r\n                <button className=\"edit-btn\" onClick={() => handleEdit(u)} title=\"Editar\">\r\n                  <Emoji symbol=\"✏️\" label=\"Editar\" />\r\n                </button>\r\n                <button className=\"delete-btn\" onClick={() => handleDelete(u)} title=\"Eliminar\" disabled={deleting || u.id === usuarioActual.id}>\r\n                  <Emoji symbol=\"🗑️\" label=\"Eliminar\" />\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n      {error && <div className=\"error-message\">{error}</div>}\r\n\r\n      {/* Modal para crear/editar */}\r\n      {modal.open && (\r\n        <div className=\"modal-backdrop\">\r\n          <div className=\"modal-content\">\r\n            <h3>\r\n              <Emoji symbol={modal.usuario ? \"✏️\" : \"➕\"} label={modal.usuario ? \"Editar\" : \"Nuevo\"} />{' '}\r\n              {modal.usuario ? 'Editar' : 'Nuevo'} Usuario\r\n            </h3>\r\n            <form className=\"modal-form\" onSubmit={handleSave}>\r\n              <label>\r\n                <Emoji symbol=\"✉️\" /> Email:\r\n                <input\r\n                  type=\"email\"\r\n                  value={form.email}\r\n                  onChange={e => setForm({ ...form, email: e.target.value })}\r\n                  required\r\n                  disabled={!!modal.usuario}\r\n                />\r\n              </label>\r\n              <label>\r\n                <Emoji symbol=\"🧑\" /> Nombre:\r\n                <input\r\n                  type=\"text\"\r\n                  value={form.nombre}\r\n                  onChange={e => setForm({ ...form, nombre: e.target.value })}\r\n                  required\r\n                />\r\n              </label>\r\n              <label>\r\n                <Emoji symbol=\"🎖️\" /> Rol:\r\n                <select\r\n                  value={form.rol}\r\n                  onChange={e => setForm({ ...form, rol: e.target.value })}\r\n                  required\r\n                >\r\n                  <option value=\"admin\">Administrador</option>\r\n                  <option value=\"registrador\">Registrador</option>\r\n                </select>\r\n              </label>\r\n              <label>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={form.activo}\r\n                  onChange={e => setForm({ ...form, activo: e.target.checked })}\r\n                /> <Emoji symbol=\"✔\" /> Usuario activo\r\n              </label>\r\n              <div style={{ marginTop: 14 }}>\r\n                <button type=\"submit\" className=\"save-btn\" disabled={saving}>\r\n                  <Emoji symbol=\"💾\" /> Guardar\r\n                </button>\r\n                <button type=\"button\" className=\"cancel-btn\" onClick={() => setModal({ open: false, usuario: null })}>\r\n                  <Emoji symbol=\"❌\" /> Cancelar\r\n                </button>\r\n              </div>\r\n              {error && <div className=\"error-message\">{error}</div>}\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":["GestionUsuarios","usuarioActual","usuarios","setUsuarios","useState","loading","setLoading","error","setError","modal","setModal","form","setForm","saving","setSaving","deleting","setDeleting","fetchUsuarios","data","supabase","useEffect","handleEdit","usuario","handleNew","handleSave","e","err","handleDelete","jsx","Loader","jsxs","Emoji","u","Fragment"],"mappings":"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"}