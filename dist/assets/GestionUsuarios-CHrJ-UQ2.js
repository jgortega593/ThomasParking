import{r as l,j as e,L as C,E as r,s as m}from"./index-B8c5qOFd.js";function U({usuarioActual:j}){const[p,y]=l.useState([]),[f,h]=l.useState(!0),[d,i]=l.useState(null),[t,c]=l.useState({open:!1,usuario:null}),[a,n]=l.useState({email:"",nombre:"",rol:"registrador",activo:!0}),[g,u]=l.useState(!1),[v,b]=l.useState(!1),x=async()=>{h(!0);const{data:s,error:o}=await m.from("usuarios_app").select("id, email, nombre, rol, activo").order("email",{ascending:!0});o?i(o.message):y(s),h(!1)};l.useEffect(()=>{x()},[]);const N=s=>{n({email:s.email,nombre:s.nombre,rol:s.rol,activo:s.activo}),c({open:!0,usuario:s})},E=()=>{n({email:"",nombre:"",rol:"registrador",activo:!0}),c({open:!0,usuario:null})},S=async s=>{if(s.preventDefault(),u(!0),i(null),!a.email||!a.nombre||!a.rol){i("Todos los campos son obligatorios"),u(!1);return}try{if(t.usuario){const{error:o}=await m.from("usuarios_app").update({email:a.email.trim().toLowerCase(),nombre:a.nombre,rol:a.rol,activo:a.activo}).eq("id",t.usuario.id);if(o)throw o}else{const{error:o}=await m.from("usuarios_app").insert([{...a,email:a.email.trim().toLowerCase()}]);if(o)throw o}c({open:!1,usuario:null}),x()}catch(o){i(o.message)}finally{u(!1)}},w=async s=>{if(window.confirm("¬øSeguro que deseas eliminar este usuario?")){b(!0),i(null);try{if(s.id===j.id){i("No puedes eliminar tu propio usuario."),b(!1);return}const{error:o}=await m.from("usuarios_app").delete().eq("id",s.id);if(o)throw o;x()}catch(o){i(o.message)}finally{b(!1)}}};return f?e.jsx(C,{text:"Cargando usuarios..."}):e.jsxs("div",{className:"gestion-usuarios-container",children:[e.jsxs("h2",{children:[e.jsx(r,{symbol:"üë•",label:"Usuarios"})," Gesti√≥n de Usuarios"]}),e.jsxs("button",{className:"edit-btn",onClick:E,style:{marginBottom:18},children:[e.jsx(r,{symbol:"‚ûï"})," Nuevo usuario"]}),e.jsxs("div",{style:{fontSize:13,color:"#888",marginBottom:12},children:[e.jsx(r,{symbol:"‚ö†Ô∏è"})," Solo usuarios ",e.jsx("b",{children:"administrador"})," pueden agregar, editar o eliminar usuarios."]}),e.jsxs("table",{className:"resultados-table",style:{marginTop:0},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{children:[e.jsx(r,{symbol:"‚úâÔ∏è",label:"Email"})," Email"]}),e.jsxs("th",{children:[e.jsx(r,{symbol:"üßë",label:"Nombre"})," Nombre"]}),e.jsxs("th",{children:[e.jsx(r,{symbol:"üéñÔ∏è",label:"Rol"})," Rol"]}),e.jsxs("th",{children:[e.jsx(r,{symbol:"‚úî",label:"Activo"})," Activo"]}),e.jsxs("th",{children:[e.jsx(r,{symbol:"‚öôÔ∏è",label:"Acciones"})," Acciones"]})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:s.nombre}),e.jsx("td",{children:s.rol==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(r,{symbol:"üëë"})," Administrador"]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{symbol:"üìã"})," Registrador"]})}),e.jsx("td",{children:s.activo?e.jsx(r,{symbol:"‚úî"}):e.jsx(r,{symbol:"‚ùå"})}),e.jsxs("td",{children:[e.jsx("button",{className:"edit-btn",onClick:()=>N(s),title:"Editar",children:e.jsx(r,{symbol:"‚úèÔ∏è",label:"Editar"})}),e.jsx("button",{className:"delete-btn",onClick:()=>w(s),title:"Eliminar",disabled:v||s.id===j.id,children:e.jsx(r,{symbol:"üóëÔ∏è",label:"Eliminar"})})]})]},s.id))})]}),d&&e.jsx("div",{className:"error-message",children:d}),t.open&&e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("h3",{children:[e.jsx(r,{symbol:t.usuario?"‚úèÔ∏è":"‚ûï",label:t.usuario?"Editar":"Nuevo"})," ",t.usuario?"Editar":"Nuevo"," Usuario"]}),e.jsxs("form",{className:"modal-form",onSubmit:S,children:[e.jsxs("label",{children:[e.jsx(r,{symbol:"‚úâÔ∏è"})," Email:",e.jsx("input",{type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value}),required:!0,disabled:!!t.usuario})]}),e.jsxs("label",{children:[e.jsx(r,{symbol:"üßë"})," Nombre:",e.jsx("input",{type:"text",value:a.nombre,onChange:s=>n({...a,nombre:s.target.value}),required:!0})]}),e.jsxs("label",{children:[e.jsx(r,{symbol:"üéñÔ∏è"})," Rol:",e.jsxs("select",{value:a.rol,onChange:s=>n({...a,rol:s.target.value}),required:!0,children:[e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"registrador",children:"Registrador"})]})]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:a.activo,onChange:s=>n({...a,activo:s.target.checked})})," ",e.jsx(r,{symbol:"‚úî"})," Usuario activo"]}),e.jsxs("div",{style:{marginTop:14},children:[e.jsxs("button",{type:"submit",className:"save-btn",disabled:g,children:[e.jsx(r,{symbol:"üíæ"})," Guardar"]}),e.jsxs("button",{type:"button",className:"cancel-btn",onClick:()=>c({open:!1,usuario:null}),children:[e.jsx(r,{symbol:"‚ùå"})," Cancelar"]})]}),d&&e.jsx("div",{className:"error-message",children:d})]})]})})]})}export{U as default};
//# sourceMappingURL=GestionUsuarios-CHrJ-UQ2.js.map
